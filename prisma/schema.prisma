generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String    @id @default(uuid())
  email              String    @unique
  name               String
  password           String
  experience         String?
  farmLocation       String?
  farmType           String?
  gender             String?
  phoneNumber        String?
  DateOfBirth        DateTime?
  resetCode          String?
  resetCodeExpiresAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // relations
  videos    Video[]
  followers Follow[]   @relation("followers")
  following Follow[]   @relation("following")
  bookmarks Bookmark[]
  comments  Comment[]
  ratings   Rating[]
  likes     Like[]
}

model Follow {
  id String @id @default(uuid())

  follower   User   @relation("following", fields: [followerId], references: [id])
  followerId String

  following   User   @relation("followers", fields: [followingId], references: [id])
  followingId String

  @@unique([followerId, followingId])
}

model Video {
  id          String @id @default(uuid())
  title       String
  description String
  videoUrl    String
  views       Int    @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ownership
  user   User   @relation(fields: [userId], references: [id])
  userId String

  // relations
  crops     VideoCrop[]
  tags      VideoTag[]
  comments  Comment[]
  ratings   Rating[]
  bookmarks Bookmark[]
  likes     Like[]

  @@index([createdAt])
}

model Crop {
  id        String   @id @default(uuid())
  name      String   @unique
  createdAt DateTime @default(now())

  videos VideoCrop[]
}

model VideoCrop {
  video   Video  @relation(fields: [videoId], references: [id], onDelete: Cascade)
  videoId String

  crop   Crop   @relation(fields: [cropId], references: [id])
  cropId String

  @@id([videoId, cropId])
}

model Tag {
  id   String @id @default(uuid())
  name String @unique

  videos VideoTag[]
}

model Like {
  id String @id @default(uuid())

  user      User     @relation(fields: [userId], references: [id])
  userId    String
  createdAt DateTime @default(now())

  video   Video  @relation(fields: [videoId], references: [id], onDelete: Cascade)
  videoId String

  @@unique([userId, videoId])
}

model VideoTag {
  video   Video  @relation(fields: [videoId], references: [id], onDelete: Cascade)
  videoId String

  tag   Tag    @relation(fields: [tagId], references: [id])
  tagId String

  @@id([videoId, tagId])
}

model Comment {
  id        String   @id @default(uuid())
  content   String
  createdAt DateTime @default(now())

  user   User   @relation(fields: [userId], references: [id])
  userId String

  video   Video  @relation(fields: [videoId], references: [id], onDelete: Cascade)
  videoId String
}

model Rating {
  id    String @id @default(uuid())
  value Int

  user   User   @relation(fields: [userId], references: [id])
  userId String

  video   Video  @relation(fields: [videoId], references: [id], onDelete: Cascade)
  videoId String

  @@unique([userId, videoId])
}

model Bookmark {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())

  user   User   @relation(fields: [userId], references: [id])
  userId String

  video   Video  @relation(fields: [videoId], references: [id], onDelete: Cascade)
  videoId String

  @@unique([userId, videoId])
}
